<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【rust】序列化框架serde | 白菜君の技术库</title>

  
  <meta name="author" content="白菜(whiteCcinn)">
  

  
  <meta name="description" content="知道做不到，等于不知道">
  

  
  <meta name="keywords" content="白菜,文辉,技术博客,whiteCcinn">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="【rust】序列化框架serde"/>

  <meta property="og:site_name" content="白菜君の技术库"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="白菜君の技术库" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">白菜君の技术库</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives/">文章</a></li>
      
        <li><a href="/tags/">标签</a></li>
      
        <li><a href="/categories/">分类</a></li>
      
        <li><a href="/about/">关于我</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>【rust】序列化框架serde</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/04/13/Rust语言/rust-序列化框架serde/" rel="bookmark">
        <time class="entry-date published" datetime="2021-04-13T02:43:43.000Z">
          2021-04-13
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Rust 中有一个 99%的程序员或许都会用到的组件，那就是序列化组件: serde。</p>
<p>众所周知，rust的静态语言，所以这让我们在序列化上繁琐了很多，但是有了serde，它帮助我们更好的序列化结构体，生产对应的数据。它实现了各种<code>声明宏</code> 以及 <code>过程宏</code> 来协助我们序列化。</p>
<p>围绕着<code>serde</code>，也有很多衍生的子组件，例如<code>serde-json</code>, <code>serde-yaml</code>, <code>serde-qs</code> 等等。</p>
<p>由于我目前在开发 <code>gitlab-rs</code>，在生成对应的query_string 以及form的数据的时候，就比较棘手。</p>
<p>所以我在<code>gitlab-rs</code> 生成的过程宏中，借助了 <code>seder</code> 出色的序列化生态来完成功能。</p>
<a id="more"></a>

<h2 id="目前围绕serde支持的序列化的数据格式组件有："><a href="#目前围绕serde支持的序列化的数据格式组件有：" class="headerlink" title="目前围绕serde支持的序列化的数据格式组件有："></a>目前围绕serde支持的序列化的数据格式组件有：</h2><ul>
<li><a href="https://github.com/serde-rs/json" target="_blank" rel="noopener">JSON</a>，许多HTTP api都使用的JavaScript对象符号。</li>
<li><a href="https://github.com/servo/bincode" target="_blank" rel="noopener">Bincode</a>，一个紧凑的二进制格式，用于伺服渲染的IPC<br>引擎。</li>
<li><a href="https://github.com/pyfisch/cbor" target="_blank" rel="noopener">CBOR</a>，一种简洁的二进制对象表示，专为小消息大小设计<br>而不需要版本协商。</li>
<li><a href="https://github.com/dtolnay/serde-yaml" target="_blank" rel="noopener">YAML</a>，一个自称对人类友好的配置语言，其实不是<br>标记语言。</li>
<li><a href="https://github.com/3Hren/msgpack-rust" target="_blank" rel="noopener">MessagePack</a>，一个高效的二进制格式，类似于一个紧凑的JSON。</li>
<li><a href="https://github.com/alexcrichton/toml-rs" target="_blank" rel="noopener">TOML</a>， <a href="http://doc.crates.io/manifest.html" target="_blank" rel="noopener">Cargo</a>使用的最小配置格式。</li>
<li><a href="https://github.com/birkenfeld/serde-pickle" target="_blank" rel="noopener">Pickle</a>， Python世界中常见的格式。</li>
<li>[罗恩]，一个生锈的符号。<br>—<a href="https://github.com/zonyitoo/bson-rs" target="_blank" rel="noopener">BSON</a>， MongoDB使用的数据存储和网络传输格式。</li>
<li><a href="https://github.com/flavray/avro-rs" target="_blank" rel="noopener">Avro</a>，在Apache Hadoop中使用的二进制格式，支持schema<br>定义。</li>
<li><a href="https://github.com/callum-oakley/json5-rs" target="_blank" rel="noopener">JSON5</a>，一个JSON的超集，包括一些来自ES5的产品。</li>
<li>[明信片]，一个不_std和嵌入式系统友好的紧凑二进制格式。<br>—<a href="https://docs.rs/serde_qs" target="_blank" rel="noopener">URL</a>查询字符串，格式为x-www-form-urlencoded。</li>
<li><a href="https://github.com/softprops/envy" target="_blank" rel="noopener">Envy</a>，一种将环境变量反序列化为锈蚀结构的方法。</li>
</ul>
<p><em>(反序列化)</em></p>
<ul>
<li><a href="https://github.com/softprops/envy-store" target="_blank" rel="noopener">Envy Store</a>，一种反序列化<a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-paramstore.html" target="_blank" rel="noopener">AWS Parameter Store</a>参数到Rust的方法<br>结构体。<em>(反序列化)</em></li>
<li><a href="https://github.com/rotty/lexpr-rs" target="_blank" rel="noopener">S-expressions</a>， Lisp使用的代码和数据的文本表示形式<br>语言的家庭。</li>
<li><a href="https://docs.rs/zvariant" target="_blank" rel="noopener">D-Bus</a>的二进制线格式。</li>
<li><a href="https://github.com/google/flatbuffers/tree/master/rust/flexbuffers" target="_blank" rel="noopener">FlexBuffers</a>，谷歌的FlatBuffers 0 -copy的无模式表兄弟<br>序列化格式。</li>
<li><a href="https://github.com/P3KI/bendy" target="_blank" rel="noopener">Bencode</a>，在BitTorrent协议中使用的一个简单的二进制格式。<br>—<a href="https://docs.rs/serde_dynamo" target="_blank" rel="noopener">DynamoDB Items</a>， <a href="https://docs.rs/rusoto_dynamodb" target="_blank" rel="noopener">rusoto_dynamodb</a>用来传输数据的格式<br>和DynamoDB。</li>
<li><a href="https://github.com/Canop/deser-hjson" target="_blank" rel="noopener">Hjson</a>，一个JSON的语法扩展，围绕人类阅读和编辑而设计。<em>(反序列化)</em></li>
</ul>
<h3 id="最简单的一个实例"><a href="#最简单的一个实例" class="headerlink" title="最简单的一个实例"></a>最简单的一个实例</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Serialize, Deserialize&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span> &#123;</span><br><span class="line">    x: <span class="built_in">i32</span>,</span><br><span class="line">    y: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> point = Point &#123; x: <span class="number">1</span>, y: <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert the Point to a JSON string.</span></span><br><span class="line">    <span class="keyword">let</span> serialized = serde_json::to_string(&amp;point).unwrap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Prints serialized = &#123;"x":1,"y":2&#125;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"serialized = &#123;&#125;"</span>, serialized);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert the JSON string back to a Point.</span></span><br><span class="line">    <span class="keyword">let</span> deserialized: Point = serde_json::from_str(&amp;serialized).unwrap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Prints deserialized = Point &#123; x: 1, y: 2 &#125;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"deserialized = &#123;:?&#125;"</span>, deserialized);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/Users/caiwenhui/.cargo/bin/cargo run --color=always --package serde_test --bin serde_test</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.01s</span><br><span class="line">     Running `target/debug/serde_test`</span><br><span class="line">serialized = &#123;"x":1,"y":2&#125;</span><br><span class="line">deserialized = Point &#123; x: 1, y: 2 &#125;</span><br></pre></td></tr></table></figure>

<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>serde-device种支持 <code>3种</code> 属性，分别是:</p>
<ul>
<li>容器属性  用于结构体或者枚举</li>
<li>字体属性  用于枚举的变体</li>
<li>字段属性  用于结构体或者枚举种的字段 </li>
</ul>
<blockquote>
<p>字体属性 仅 用于枚举</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Serialize, Deserialize&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="meta">#[serde(deny_unknown_fields)]</span>  <span class="comment">// &lt;-- this is a container attribute</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span></span> &#123;</span><br><span class="line">    <span class="meta">#[serde(default)]</span>  <span class="comment">// &lt;-- this is a field attribute</span></span><br><span class="line">    f: <span class="built_in">i32</span>,</span><br><span class="line">    s_e: E</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="meta">#[serde(rename = <span class="meta-string">"e"</span>)]</span>  <span class="comment">// &lt;-- this is also a container attribute</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span></span> &#123;</span><br><span class="line">    <span class="meta">#[serde(rename = <span class="meta-string">"a"</span>)]</span>  <span class="comment">// &lt;-- this is a variant attribute</span></span><br><span class="line">    A(<span class="built_in">String</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> point_s = S &#123; f: <span class="number">1</span> , s_e: E::A(<span class="built_in">String</span>::from(<span class="string">"inner-enum"</span>))&#125;;</span><br><span class="line">    <span class="comment">// Convert the Point to a JSON string.</span></span><br><span class="line">    <span class="keyword">let</span> serialized_a = serde_json::to_string(&amp;point_s).unwrap();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"serialized_a: &#123;&#125;"</span>, serialized_a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> point_e = E::A(<span class="built_in">String</span>::from(<span class="string">"my-enum"</span>));</span><br><span class="line">    <span class="comment">// Convert the Point to a JSON string.</span></span><br><span class="line">    <span class="keyword">let</span> serialized_e = serde_json::to_string(&amp;point_e).unwrap();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"serialized_e: &#123;&#125;"</span>, serialized_e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/Users/caiwenhui/.cargo/bin/cargo run --color=always --package serde_test --bin serde_test</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.01s</span><br><span class="line">     Running `target/debug/serde_test`</span><br><span class="line">serialized_a: &#123;"f":1,"s_e":&#123;"a":"inner-enum"&#125;&#125;</span><br><span class="line">serialized_e: &#123;"a":"my-enum"&#125;</span><br></pre></td></tr></table></figure>

<p>既然我们知道了serde有种类型的属性，具体都有哪些属性，大家一定也感兴趣。</p>
<h4 id="容器属性-Container-attributes"><a href="#容器属性-Container-attributes" class="headerlink" title="容器属性(Container attributes)"></a>容器属性(Container attributes)</h4><h5 id="serde-rename-“name”"><a href="#serde-rename-“name”" class="headerlink" title="#[serde(rename = “name”)]"></a>#[serde(rename = “name”)]</h5><p><code>#[serde(rename = &quot;name&quot;)]</code></p>
<p>序列化和反序列化的时候用一个名字来代替Rust结构体的名字</p>
<p>当然，也允许独立设置和分别设置:</p>
<ul>
<li><code>#[serde(rename(serialize = &quot;ser_name&quot;))]</code></li>
<li><code>#[serde(rename(deserialize = &quot;de_name&quot;))]</code></li>
<li><code>#[serde(rename(serialize = &quot;ser_name&quot;, deserialize = &quot;de_name&quot;))]</code></li>
</ul>
<h5 id="serde-rename-all-“…”"><a href="#serde-rename-all-“…”" class="headerlink" title="#[serde(rename_all = “…”)]"></a>#[serde(rename_all = “…”)]</h5><p><code>#[serde(rename_all = &quot;...&quot;)]</code></p>
<p>根据给定的大小写约定重命名所有字段（如果这是一个结构）或变量（如果这是一个枚举）。可能的值是<code>&quot;lowercase&quot;</code>,<br>  <code>&quot;UPPERCASE&quot;</code>, <code>&quot;PascalCase&quot;</code>, <code>&quot;camelCase&quot;</code>, <code>&quot;snake_case&quot;</code>,<br>  <code>&quot;SCREAMING_SNAKE_CASE&quot;</code>, <code>&quot;kebab-case&quot;</code>, <code>&quot;SCREAMING-KEBAB-CASE&quot;</code>。</p>
<p>顾名思义，这个容器属性主要是允许你定义驼峰，蛇形等序列化以及反序列化的字段</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Serialize, Deserialize&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="meta">#[serde(deny_unknown_fields)]</span>  <span class="comment">// &lt;-- this is a container attribute</span></span><br><span class="line"><span class="meta">#[serde(rename_all = <span class="meta-string">"UPPERCASE"</span>)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span></span> &#123;</span><br><span class="line">    <span class="meta">#[serde(default)]</span>  <span class="comment">// &lt;-- this is a field attribute</span></span><br><span class="line">    f: <span class="built_in">i32</span>,</span><br><span class="line">    hello_world: E</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="meta">#[serde(rename = <span class="meta-string">"e"</span>)]</span>  <span class="comment">// &lt;-- this is also a container attribute</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span></span> &#123;</span><br><span class="line">    <span class="meta">#[serde(rename = <span class="meta-string">"a"</span>)]</span>  <span class="comment">// &lt;-- this is a variant attribute</span></span><br><span class="line">    A(<span class="built_in">String</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> point_s = S &#123; f: <span class="number">1</span> , hello_world: E::A(<span class="built_in">String</span>::from(<span class="string">"inner-enum"</span>))&#125;;</span><br><span class="line">    <span class="comment">// Convert the Point to a JSON string.</span></span><br><span class="line">    <span class="keyword">let</span> serialized_a = serde_json::to_string(&amp;point_s).unwrap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// normal output =&gt; serialized_a: &#123;"f":1,"hello_world":&#123;"a":"inner-enum"&#125;&#125;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"serialized_a: &#123;&#125;"</span>, serialized_a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/Users/caiwenhui/.cargo/bin/cargo run --color=always --package serde_test --bin serde_test</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.02s</span><br><span class="line">     Running `target/debug/serde_test`</span><br><span class="line">serialized_a: &#123;"F":1,"HELLO_WORLD":&#123;"a":"inner-enum"&#125;&#125;</span><br></pre></td></tr></table></figure>



<h5 id="serde-deny-unknown-fields"><a href="#serde-deny-unknown-fields" class="headerlink" title="#[serde(deny_unknown_fields)]"></a>#[serde(deny_unknown_fields)]</h5><p>遇到未知字段时，在反序列化期间始终会出错。当此属性不存在时，默认情况下，对于诸如JSON之类的自描述格式，未知字段将被忽略。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Serialize, Deserialize&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span></span> &#123;</span><br><span class="line">    <span class="meta">#[serde(default)]</span></span><br><span class="line">    f: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> s = r#<span class="string">"</span></span><br><span class="line"><span class="string">    &#123;"</span>f<span class="string">":1,"</span>s_e<span class="string">":&#123;"</span>a<span class="string">":"</span>inner-<span class="class"><span class="keyword">enum</span>"&#125;&#125;</span></span><br><span class="line"><span class="class">    "#;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">let</span></span> uns: S = serde_json::from_str(&amp;s).unwrap();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"un: &#123;:?&#125;"</span>, uns);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/Users/caiwenhui/.cargo/bin/cargo run --color=always --package serde_test --bin serde_test</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.02s</span><br><span class="line">     Running `target/debug/serde_test`</span><br><span class="line">un: S &#123; f: 1&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到成功输出。如果没有匹配到字段到话会自动忽略。但是如果你希望严格到匹配的话。那么就可以加上此容器属性.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Serialize, Deserialize&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Serialize, Deserialize, Debug)]</span></span><br><span class="line"><span class="meta">#[serde(deny_unknown_fields)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span></span> &#123;</span><br><span class="line">    <span class="meta">#[serde(default)]</span></span><br><span class="line">    f: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> s = r#<span class="string">"</span></span><br><span class="line"><span class="string">    &#123;"</span>f<span class="string">":1,"</span>s_e<span class="string">":&#123;"</span>a<span class="string">":"</span>inner-<span class="class"><span class="keyword">enum</span>"&#125;&#125;</span></span><br><span class="line"><span class="class">    "#;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">let</span></span> uns: S = serde_json::from_str(&amp;s).unwrap();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"un: &#123;:?&#125;"</span>, uns);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/Users/caiwenhui/.cargo/bin/cargo run --color=always --package serde_test --bin serde_test</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.02s</span><br><span class="line">     Running `target/debug/serde_test`</span><br><span class="line">thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Error("unknown field `s_e`, expected `f` or `s_e`", line: 2, column: 44)', src/main.rs:34:43</span><br><span class="line">stack backtrace:</span><br><span class="line">   0: rust_begin_unwind</span><br><span class="line">             at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:495:5</span><br><span class="line">   1: core::panicking::panic_fmt</span><br><span class="line">             at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/panicking.rs:92:14</span><br><span class="line">   2: core::option::expect_none_failed</span><br><span class="line">             at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/option.rs:1268:5</span><br><span class="line">   3: core::result::Result&lt;T,E&gt;::unwrap</span><br><span class="line">             at /Users/caiwenhui/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/src/rust/library/core/src/result.rs:973:23</span><br><span class="line">   4: serde_test::main</span><br><span class="line">             at ./src/main.rs:34:18</span><br><span class="line">   5: core::ops::function::FnOnce::call_once</span><br><span class="line">             at /Users/caiwenhui/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/src/rust/library/core/src/ops/function.rs:227:5</span><br><span class="line">note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.</span><br></pre></td></tr></table></figure>

<p>可以看到这里会报错.</p>
<h5 id="serde-tag-“type”"><a href="#serde-tag-“type”" class="headerlink" title="#[serde(tag = “type”)]"></a>#[serde(tag = “type”)]</h5><p>该属性只适用于枚举体，具体用法详见:[ enum representations ](<a href="https://github.com/serde-rs/serde-rs.github.io/blob/master/_src/enum-representations.md" target="_blank" rel="noopener">https://github.com/serde-rs/serde-rs.github.io/blob/master/_src/enum-representations.md</a>)</p>
<h5 id="serde-tag-“t”-content-“c”"><a href="#serde-tag-“t”-content-“c”" class="headerlink" title="#[serde(tag = “t”, content = “c”)]"></a>#[serde(tag = “t”, content = “c”)]</h5><p>该属性只适用于枚举体，具体用法详见:[ enum representations ](<a href="https://github.com/serde-rs/serde-rs.github.io/blob/master/_src/enum-representations.md" target="_blank" rel="noopener">https://github.com/serde-rs/serde-rs.github.io/blob/master/_src/enum-representations.md</a>)</p>
<h5 id="serde-untagged"><a href="#serde-untagged" class="headerlink" title="#[serde(untagged)]"></a>#[serde(untagged)]</h5><p>该属性只适用于枚举体，具体用法详见:[ enum representations ](<a href="https://github.com/serde-rs/serde-rs.github.io/blob/master/_src/enum-representations.md" target="_blank" rel="noopener">https://github.com/serde-rs/serde-rs.github.io/blob/master/_src/enum-representations.md</a>)</p>
<h2 id="serde"><a href="#serde" class="headerlink" title="serde"></a>serde</h2><h2 id="serde-qs"><a href="#serde-qs" class="headerlink" title="serde-qs"></a>serde-qs</h2>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/rust/">rust</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/rust/">rust</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 白菜(whiteCcinn)
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>