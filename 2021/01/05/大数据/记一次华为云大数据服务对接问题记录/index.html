<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【大数据】- 记一次华为云大数据服务对接问题记录 | 白菜君の技术库</title>

  
  <meta name="author" content="白菜(whiteCcinn)">
  

  
  <meta name="description" content="知道做不到，等于不知道">
  

  
  <meta name="keywords" content="白菜,文辉,技术博客,whiteCcinn">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="【大数据】- 记一次华为云大数据服务对接问题记录"/>

  <meta property="og:site_name" content="白菜君の技术库"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="白菜君の技术库" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">白菜君の技术库</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives/">文章</a></li>
      
        <li><a href="/tags/">标签</a></li>
      
        <li><a href="/categories/">分类</a></li>
      
        <li><a href="/about/">关于我</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>【大数据】- 记一次华为云大数据服务对接问题记录</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/05/大数据/记一次华为云大数据服务对接问题记录/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-05T01:56:40.000Z">
          2021-01-05
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于我们在调研是否让自建IDC大数据机房上云服务，所以华为云进行一下测试。</p>
<a id="more"></a>

<h2 id="问题一：impala的连接问题"><a href="#问题一：impala的连接问题" class="headerlink" title="问题一：impala的连接问题"></a>问题一：impala的连接问题</h2><p>由于我们开启了<code>Kerberos</code>，所以我们在终端执行<code>impala-shell</code>的时候，默认情况下是连不上的。需要通过<code>Kerberos</code>进行<code>身份校验</code>和<code>授权</code>才可以访问。</p>
<p>我们创建了一个名字叫<code>hiveuser</code>的账号，目前所有的组件服务都通过该账号进行访问。</p>
<p>所以我们需要初始化和续期凭据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node-str-coreoVpr ~]# impala-shell</span><br><span class="line">Starting Impala Shell without Kerberos authentication</span><br><span class="line">Error connecting: TTransportException, Could not connect to node-str-coreoVpr:21000</span><br><span class="line">Kerberos ticket found in the credentials cache, retrying the connection with a secure transport.</span><br><span class="line">Error connecting: TTransportException, Could not connect to node-str-coreoVpr:21000</span><br><span class="line">***********************************************************************************</span><br><span class="line">Welcome to the Impala shell.</span><br><span class="line">(Impala Shell v3.2.0 (f63543a) built on Wed Nov  6 11:46:33 CST 2019)</span><br><span class="line"></span><br><span class="line">Want to know what version of Impala you&#39;re connected to? Run the VERSION command to</span><br><span class="line">find out!</span><br><span class="line">***********************************************************************************</span><br><span class="line">[Not connected] &gt; quit;</span><br><span class="line">Connection lost, reconnecting...</span><br><span class="line">Error connecting: TTransportException, Could not connect to node-str-coreoVpr:21000</span><br><span class="line">Goodbye root</span><br></pre></td></tr></table></figure>

<p>可以看到，我们是连不上的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node-str-coreoVpr ~]# kinit hiveuser@122451B2_394D_494B_9FCA_B045F596D6D4.COM</span><br><span class="line">Password for hiveuser@122451B2_394D_494B_9FCA_B045F596D6D4.COM:</span><br><span class="line"></span><br><span class="line">[root@node-str-coreoVpr ~]# klist</span><br><span class="line">Ticket cache: FILE:&#x2F;tmp&#x2F;krb5cc_0</span><br><span class="line">Default principal: hiveuser@122451B2_394D_494B_9FCA_B045F596D6D4.COM</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">01&#x2F;05&#x2F;2021 17:05:25  01&#x2F;06&#x2F;2021 17:05:21  krbtgt&#x2F;122451B2_394D_494B_9FCA_B045F596D6D4.COM@122451B2_394D_494B_9FCA_B045F596D6D4.COM</span><br></pre></td></tr></table></figure>

<p>再次尝试连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node-str-coreoVpr ~]# impala-shell -i node-ana-coretXnL</span><br><span class="line">Starting Impala Shell without Kerberos authentication</span><br><span class="line">Opened TCP connection to node-ana-coretXnL:21000</span><br><span class="line">Error connecting: TTransportException, TSocket read 0 bytes</span><br><span class="line">Kerberos ticket found in the credentials cache, retrying the connection with a secure transport.</span><br><span class="line">Opened TCP connection to node-ana-coretXnL:21000</span><br><span class="line">Connected to node-ana-coretXnL:21000</span><br><span class="line">Server version: impalad version 3.2.0 RELEASE (build 83150778f5d85f48878f611da47face9328e9e6a)</span><br><span class="line">***********************************************************************************</span><br><span class="line">Welcome to the Impala shell.</span><br><span class="line">(Impala Shell v3.2.0 (f63543a) built on Wed Nov  6 11:46:33 CST 2019)</span><br><span class="line"></span><br><span class="line">Press TAB twice to see a list of available commands.</span><br><span class="line">***********************************************************************************</span><br><span class="line">[node-ana-coretXnL:21000] default&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到，已经可以连接上了。</p>
<h2 id="问题一：flume-amp-amp-kudu"><a href="#问题一：flume-amp-amp-kudu" class="headerlink" title="问题一：flume &amp;&amp; kudu"></a>问题一：flume &amp;&amp; kudu</h2><p>目前，我们对基本配置如下：</p>
<table>
<thead>
<tr>
<th>服务</th>
<th align="center">版本</th>
</tr>
</thead>
<tbody><tr>
<td>flume</td>
<td align="center">1.6</td>
</tr>
<tr>
<td>kudu</td>
<td align="center">1.9</td>
</tr>
</tbody></table>
<blockquote>
<p>Kerberos</p>
</blockquote>
<p>由于flume官方没有提供对应的sink。但是kudu有提供，所以我去找了kudu的sink的jar库下来。而版本对应嘛，一开始我们使用和kudu一样的1.9版本，发现api对应不上。查阅了资料之后，选择了1.4版本。</p>
<p><a href="https://mvnrepository.com/artifact/org.apache.kudu/kudu-flume-sink/1.4.0?__cf_chl_captcha_tk__=7487a6e6d3af56e81833e042ecdd828beb02882a-1609912123-0-AUmmEDCceLCSAVoPRrj8gzU7DJiq0s6FDvbgtDuPNfnkQTpt6VhrByHJNPAW6OqwOUwy0Q-n6GMXMkdwYsWU3MaV8wittp6D5FDijZeJqG8TNgPpuqc3aP1HKMEpyWvRWHUt3zuktylr8P2yT1PNxi1072tE1YU0DpCJAyDsd9hXVKFgATWgSqysO-VYDm7734rOkyA_hIGFIlm_M9SmJoeKnXkVtVuYEVfvioLp_jJ-fYtJ7JXb2Flv-84qw5_CACpgSG6MQclMt-KjamTut5gPyUm_I0RhwSyMzsC07oSFq47KV0ckhsXoghJud1QsxqlSu2VNpR8IjA23bp1qIPLGmxxrQ0GEcZuCjBMUtLSkPHGzTYgjXu6Os5LMP8deUirp5OLmJ-9Jma8FSRvW5tIkQEpuHw9cUvhAqQSmONyFDTUal_War9HvzntivDc4bhsmuDc7t2spTT8_3Y6mwWUuQD8nE4qxlainXMtXIoeK_FD5O8qNFLKAdzL2cudLjlATsSjSSNMXRzlgGf73c_yieLyjHA4vgvxswnmfRgEh-tnfLVW8_U58OkahQxNs4kWVVjgPAr4lARgFeRV1FxQKYMvbrwHcnxL8RZyvMYIAPmsKF9ClFK-UyuxFKpT3ezseQWzEeTmliATFwT_ope0" target="_blank" rel="noopener">kudu-flume-sink-1.4.jar</a></p>
<p>需要把jar包放在 java运行程序的 <code>classpath目录下</code>，也就是 <code>-cp 参数的目录下</code>。由于不想通过修改<code>GC_OPTS</code>来指定目录，所以我选择了放在 <code>/opt/Bigdata/MRS_2.1.0/install/FusionInsight-Flume-1.6.0/flume/lib/*</code> 目录下。</p>
<blockquote>
<p>可是谁曾想最后还要是动到 <code>GC_OPTS</code>到参数配置</p>
</blockquote>
<p>还是类似的问题，目前遇到的问题几乎都是 <code>Kerberos</code> 引起的。因为以往我们并没有使用 <code>Kerberos</code> 作为身份认证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># &#x3D;                  定义信息                       &#x3D;</span><br><span class="line"># &#x3D; 华为云Agent必填:                                &#x3D;</span><br><span class="line"># &#x3D;  - server                                       &#x3D;</span><br><span class="line"># &#x3D; Agent中存在的sources:                           &#x3D;</span><br><span class="line"># &#x3D;  - src_http_41600                               &#x3D;</span><br><span class="line"># &#x3D; Agent中存在的channels:                          &#x3D;</span><br><span class="line"># &#x3D;  - ch_kudu_table                                &#x3D;</span><br><span class="line"># &#x3D; Agent中存在的sinks:                             &#x3D;</span><br><span class="line"># &#x3D;  - sink_kudu_table                              &#x3D;</span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">server.sources  &#x3D; src_http_41600</span><br><span class="line">server.channels &#x3D; ch_kudu_table</span><br><span class="line">server.sinks    &#x3D; sink_kudu_table</span><br><span class="line"></span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># &#x3D;               Http Source                       &#x3D;</span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">server.sources.src_http_41600.type &#x3D; http</span><br><span class="line">server.sources.src_http_41600.port &#x3D; 41600</span><br><span class="line">server.sources.src_http_41600.channels &#x3D; ch_kudu_table</span><br><span class="line"></span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># &#x3D;               Http-Kudu&#39;s Channel               &#x3D;</span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">server.channels.ch_kudu_table.type &#x3D; memory</span><br><span class="line">server.channels.ch_kudu_table.capacity &#x3D; 1000</span><br><span class="line">server.channels.ch_kudu_table.transactionCapacity &#x3D; 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># server.sinks.sink_kudu_table.type &#x3D; logger</span><br><span class="line"># server.sinks.sink_kudu_table.channel &#x3D; ch_kudu_table</span><br><span class="line"></span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># &#x3D;                    Kudu Sink                    &#x3D;</span><br><span class="line"># &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># 组件名，必须填写&#96;org.apache.kudu.flume.sink.KuduSink&#96;</span><br><span class="line">server.sinks.sink_kudu_table.type &#x3D; org.apache.kudu.flume.sink.KuduSink</span><br><span class="line"># 要绑定读取的channel</span><br><span class="line">server.sinks.sink_kudu_table.channel &#x3D; ch_kudu_table</span><br><span class="line">server.sinks.sink_kudu_table.masterAddresses &#x3D; node-master1rfFB,node-ana-corezDdi,node-master2RSDt</span><br><span class="line">server.sinks.sink_kudu_table.tableName &#x3D; impala::kudu_test.my_first_table</span><br></pre></td></tr></table></figure>

<p>测试的时候所采用的配置如上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">omm      17051     1  0 11:31 ?        00:00:09 &#x2F;opt&#x2F;Bigdata&#x2F;jdk1.8.0_212&#x2F;&#x2F;bin&#x2F;java -XX:OnOutOfMemoryError&#x3D;bash &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;bin&#x2F;out_memory_error.sh &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc %p -Xms2G -Xmx4G -XX:CMSFullGCsBeforeCompaction&#x3D;1 -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -XX:+UseCMSCompactAtFullCollection -Djava.security.krb5.conf&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;krb5.conf -Djava.security.auth.login.config&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;jaas.conf -Dzookeeper.request.timeout&#x3D;120000 -Djavax.security.auth.useSubjectCredsOnly&#x3D;false -verbose:gc -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles&#x3D;10 -XX:GCLogFileSize&#x3D;1M -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:&#x2F;var&#x2F;log&#x2F;Bigdata&#x2F;flume&#x2F;&#x2F;flume&#x2F;flume-omm-20210106113125-%p-gc.log -Djava.security.krb5.conf&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_5_KerberosClient&#x2F;etc&#x2F;kdc.conf -Djava.security.auth.login.config&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;jaas.conf -Dzookeeper.server.principal&#x3D;zookeeper&#x2F;hadoop.122451b2_394d_494b_9fca_b045f596d6d4.com -Dzookeeper.request.timeout&#x3D;120000 -Dsolrclient.token.enabled&#x3D;false -Dcom.amazonaws.sdk.disableCertChecking&#x3D;true -Dnet.sf.ehcache.skipUpdateCheck&#x3D;true -Dflume.instance.id&#x3D;1000 -Dflume.role&#x3D;server -Dlog4j.configuration.watch&#x3D;true -Dlog4j.configuration&#x3D;log4j.properties -Dflume_log_dir&#x3D;&#x2F;var&#x2F;log&#x2F;Bigdata&#x2F;flume&#x2F;&#x2F;flume&#x2F; -Dflume.monitoring.type&#x3D;http -Dflume.monitoring.port&#x3D;21150 -Dbeetle.application.home.path&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;conf&#x2F;service -Dflume.called.from.service -Dflume.conf.dir&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc -Dflume.metric.conf.dir&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;conf -Dflume.script.home&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;bin -cp &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc:&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;lib&#x2F;*:&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;conf&#x2F;service&#x2F; -Djava.library.path&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;plugins.d&#x2F;native&#x2F;native org.apache.flume.node.Application --conf-file &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;properties.properties --name server</span><br></pre></td></tr></table></figure>
<p>启动的参数如上，其中有几个参数是我后面加的：</p>
<ul>
<li>-Djava.security.krb5.conf=/opt/Bigdata/MRS_2.1.0/1_7_Flume/etc/krb5.conf   （指定krb5的配置文件路径）</li>
<li>-Djava.security.auth.login.config=/opt/Bigdata/MRS_2.1.0/1_7_Flume/etc/jaas.conf (获取jass的认证配置文件路径)</li>
<li>-Dzookeeper.request.timeout=120000</li>
<li>-Djavax.security.auth.useSubjectCredsOnly=false (通过底层获取凭据)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@node-str-coreoVpr ~]# cat &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;jaas.conf</span><br><span class="line">KafkaClient &#123;</span><br><span class="line">com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">useKeyTab&#x3D;true</span><br><span class="line">keyTab&#x3D;&quot;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;user.keytab&quot;</span><br><span class="line">principal&#x3D;&quot;hiveuser@122451B2_394D_494B_9FCA_B045F596D6D4.COM&quot;</span><br><span class="line">storeKey&#x3D;true</span><br><span class="line">useTicketCache&#x3D;false;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Client &#123;</span><br><span class="line">com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">storeKey&#x3D;true</span><br><span class="line">principal&#x3D;&quot;hiveuser@122451B2_394D_494B_9FCA_B045F596D6D4.COM&quot;</span><br><span class="line">useTicketCache&#x3D;false</span><br><span class="line">keyTab&#x3D;&quot;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;user.keytab&quot;</span><br><span class="line">debug&#x3D;true</span><br><span class="line">useKeyTab&#x3D;true;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">com.sun.security.jgss.initiate &#123;</span><br><span class="line">com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">useKeyTab&#x3D;true</span><br><span class="line">useTicketCache&#x3D;false</span><br><span class="line">doNotPrompt&#x3D;true</span><br><span class="line">storeKey&#x3D;true</span><br><span class="line">principal&#x3D;&quot;hiveuser@122451B2_394D_494B_9FCA_B045F596D6D4.COM&quot;</span><br><span class="line">keyTab&#x3D;&quot;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;user.keytab&quot;</span><br><span class="line">debug&#x3D;true;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>由于华为云自己修改过部分组件，所以不太确定为什么凭据一直失败，所以我加了 <code>-Djavax.security.auth.useSubjectCredsOnly=false</code> 参数，这是让我们从底层去拿凭据，而默认拿的<code>section</code>部分就是 <code>com.sun.security.jgss.initiate</code><a href="https://github.com/frohoff/jdk8u-dev-jdk/blob/master/src/share/classes/sun/security/jgss/LoginConfigImpl.java#L92" target="_blank" rel="noopener">详见源码</a>,所以加上了 <code>com.sun.security.jgss.initiate</code> 之后，flume就可以连接上了kudu.</p>
<p>以下是我调试的时候遇到的问题。</p>
<ul>
<li><p>GSSException: No valid credentials provided (Mechanism level: Failed to find any Kerberos Ticket) Cause: This may occur if no valid Kerberos credentials are obtained. In particular, this occurs if you want the underlying mechanism to obtain credentials but you forgot to indicate this by setting the javax.security.auth.useSubjectCredsOnly system property value to false (for example via -Djavax.security.auth.useSubjectCredsOnly=false in your execution command).</p>
</li>
<li><p>GSSException: No valid credentials provided (Mechanism level: Attempt to obtain new INITIATE credentials failed! (null)) . . . Caused by: javax.security.auth.login.LoginException: Clock skew too great Cause: Kerberos requires the time on the KDC and on the client to be loosely synchronized. (The default is within 5 minutes.) If that’s not the case, you will get this error.</p>
</li>
</ul>
<p>附上 <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/security/jgss/tutorials/Troubleshooting.html" target="_blank" rel="noopener">jgss 的异常尝试解决方案官方文档</a>, PS：反正我根据文档没解决，不知道是不是华运自己修改的部分有什么潜规则。所以我才采用默认的jass配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">2021-01-06 11:31:26,235 | INFO  | [lifecycleSupervisor-1-0] |  Configuration provider starting  | org.apache.flume.node.PollingPropertiesFileConfigurationProvider.start(PollingPropertiesFileConfigurationProvider.java:61)</span><br><span class="line">2021-01-06 11:31:26,239 | INFO  | [conf-file-poller-0] |  Reloading configuration file:&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;properties.properties  | org.apache.flume.node.PollingPropertiesFileConfigurationProvider$FileWatcherR</span><br><span class="line">unnable.run(PollingPropertiesFileConfigurationProvider.java:133)</span><br><span class="line">2021-01-06 11:31:26,236 | INFO  | [main] |  starting taskCounter  | org.apache.flume.tools.FlumeMetricsMgr.start(FlumeMetricsMgr.java:230)</span><br><span class="line">2021-01-06 11:31:26,250 | INFO  | [conf-file-poller-0] |  Processing:sink_kudu_table  | org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addProperty(FlumeConfiguration.java:1017)</span><br><span class="line">2021-01-06 11:31:26,250 | INFO  | [conf-file-poller-0] |  Processing:sink_kudu_table  | org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addProperty(FlumeConfiguration.java:1017)</span><br><span class="line">2021-01-06 11:31:26,250 | INFO  | [conf-file-poller-0] |  Processing:sink_kudu_table  | org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addProperty(FlumeConfiguration.java:1017)</span><br><span class="line">2021-01-06 11:31:26,251 | INFO  | [conf-file-poller-0] |  Processing:sink_kudu_table  | org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addProperty(FlumeConfiguration.java:1017)</span><br><span class="line">2021-01-06 11:31:26,251 | INFO  | [conf-file-poller-0] |  Added sinks: sink_kudu_table Agent: server  | org.apache.flume.conf.FlumeConfiguration$AgentConfiguration.addProperty(FlumeConfiguration.java:931)</span><br><span class="line">2021-01-06 11:31:26,262 | INFO  | [conf-file-poller-0] |  Post-validation flume configuration contains configuration for agents: [server]  | org.apache.flume.conf.FlumeConfiguration.validateConfiguration(FlumeConfiguration.java:141)</span><br><span class="line">2021-01-06 11:31:26,263 | INFO  | [conf-file-poller-0] |  Creating channels  | org.apache.flume.node.AbstractConfigurationProvider.loadChannels(AbstractConfigurationProvider.java:155)</span><br><span class="line">2021-01-06 11:31:26,270 | INFO  | [conf-file-poller-0] |  Creating instance of channel ch_kudu_table type memory  | org.apache.flume.channel.DefaultChannelFactory.create(DefaultChannelFactory.java:42)</span><br><span class="line">2021-01-06 11:31:26,274 | INFO  | [conf-file-poller-0] |  Created channel ch_kudu_table  | org.apache.flume.node.AbstractConfigurationProvider.loadChannels(AbstractConfigurationProvider.java:210)</span><br><span class="line">2021-01-06 11:31:26,274 | INFO  | [conf-file-poller-0] |  Creating instance of source src_http_41600, type http  | org.apache.flume.source.DefaultSourceFactory.create(DefaultSourceFactory.java:41)</span><br><span class="line">2021-01-06 11:31:26,289 | INFO  | [main] |  Monitored counter group for type: OTHER, name: taskcount: Successfully registered new MBean.  | org.apache.flume.instrumentation.MonitoredCounterGroup.register(MonitoredCounterGroup.java:132)</span><br><span class="line">2021-01-06 11:31:26,290 | INFO  | [main] |  Component type: OTHER, name: taskcount started  | org.apache.flume.instrumentation.MonitoredCounterGroup.start(MonitoredCounterGroup.java:105)</span><br><span class="line">2021-01-06 11:31:26,323 | INFO  | [conf-file-poller-0] |  Creating instance of sink: sink_kudu_table, type: org.apache.kudu.flume.sink.KuduSink  | org.apache.flume.sink.DefaultSinkFactory.create(DefaultSinkFactory.java:42)</span><br><span class="line">2021-01-06 11:31:26,328 | WARN  | [conf-file-poller-0] |  No Kudu operations producer provided, using default  | org.apache.kudu.flume.sink.KuduSink.configure(KuduSink.java:202)</span><br><span class="line">2021-01-06 11:31:26,330 | INFO  | [conf-file-poller-0] |  Channel ch_kudu_table connected to [src_http_41600, sink_kudu_table]  | org.apache.flume.node.AbstractConfigurationProvider.getConfiguration(AbstractConfigurationProvider.java:124)</span><br><span class="line">2021-01-06 11:31:26,413 | INFO  | [main] |  ServiceServer started (at port[21151])  | org.wcc.framework.business.service.server.ServiceServer.start(ServiceServer.java:260)</span><br><span class="line">2021-01-06 11:31:26,413 | INFO  | [main] |  flume meric server startred ip:192.168.0.222,port:21151.  | org.apache.flume.tools.FlumeMetricsMgr.initMetricsRpcServer(FlumeMetricsMgr.java:84)</span><br><span class="line">2021-01-06 11:31:26,413 | INFO  | [main] |  current role is server  | org.apache.flume.tools.FlumeMetricsMgr.start(FlumeMetricsMgr.java:237)</span><br><span class="line">2021-01-06 11:31:26,429 | INFO  | [main] |  Logging to org.slf4j.impl.Log4jLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog  | org.mortbay.log.Slf4jLog.info(Slf4jLog.java:67)</span><br><span class="line">2021-01-06 11:31:26,430 | INFO  | [main] |  jetty-6.1.26  | org.mortbay.log.Slf4jLog.info(Slf4jLog.java:67)</span><br><span class="line">2021-01-06 11:31:26,441 | INFO  | [main] |  Started SelectChannelConnector@localhost:21150  | org.mortbay.log.Slf4jLog.info(Slf4jLog.java:67)</span><br><span class="line">2021-01-06 11:31:26,442 | INFO  | [main] |  starting compment mon  | org.apache.flume.node.Application.startCompMon(Application.java:543)</span><br><span class="line">2021-01-06 11:31:26,443 | INFO  | [main] |  started compment mon success  | org.apache.flume.node.Application.startCompMon(Application.java:582)</span><br><span class="line">2021-01-06 11:31:26,443 | INFO  | [main] |  log4j dynamic load is start.  | org.apache.flume.tools.LogDynamicLoad.start(LogDynamicLoad.java:59)</span><br><span class="line">2021-01-06 11:31:26,444 | INFO  | [conf-file-poller-0] |  stopping compment mon  | org.apache.flume.node.Application.stopCompMon(Application.java:587)</span><br><span class="line">2021-01-06 11:31:26,444 | INFO  | [conf-file-poller-0] |  stopped compment mon success  | org.apache.flume.node.Application.stopCompMon(Application.java:608)</span><br><span class="line">2021-01-06 11:31:26,444 | INFO  | [conf-file-poller-0] |  Starting new configuration:&#123; sourceRunners:&#123;src_http_41600&#x3D;EventDrivenSourceRunner: &#123; source:org.apache.flume.source.http.HTTPSource&#123;name:src_http_41600,state:IDLE&#125; &#125;&#125; sinkRunners:&#123;sink_kudu_table&#x3D;SinkRunner: &#123; policy:org.apache.flume.sink.DefaultSinkProcessor@1e1f84ee counterGroup:&#123; name:null counters:&#123;&#125; &#125; &#125;&#125; channels:&#123;ch_kudu_table&#x3D;org.apache.flume.channel.MemoryChannel&#123;name: ch_kudu_table&#125;&#125; &#125;  | org.apache.flume.node.Application.startAllComponents(Application.java:206)</span><br><span class="line">2021-01-06 11:31:26,498 | INFO  | [conf-file-poller-0] |  current role is server  | org.apache.flume.tools.FlumeSendAlarmMgr.start(FlumeSendAlarmMgr.java:173)</span><br><span class="line">2021-01-06 11:31:26,505 | INFO  | [conf-file-poller-0] |  Starting Channel ch_kudu_table  | org.apache.flume.node.Application.startAllComponents(Application.java:217)</span><br><span class="line">2021-01-06 11:31:26,508 | INFO  | [lifecycleSupervisor-1-0] |  Monitored counter group for type: CHANNEL, name: ch_kudu_table: Successfully registered new MBean.  | org.apache.flume.instrumentation.MonitoredCounterGroup.register(MonitoredCounterGroup.java:132)</span><br><span class="line">2021-01-06 11:31:26,508 | INFO  | [lifecycleSupervisor-1-0] |  Component type: CHANNEL, name: ch_kudu_table started  | org.apache.flume.instrumentation.MonitoredCounterGroup.start(MonitoredCounterGroup.java:105)</span><br><span class="line">2021-01-06 11:31:26,508 | INFO  | [conf-file-poller-0] |  Starting Sink sink_kudu_table  | org.apache.flume.node.Application.startAllComponents(Application.java:245)</span><br><span class="line">2021-01-06 11:31:26,508 | INFO  | [conf-file-poller-0] |  Starting Source src_http_41600  | org.apache.flume.node.Application.startAllComponents(Application.java:256)</span><br><span class="line">2021-01-06 11:31:26,510 | INFO  | [conf-file-poller-0] |  Begin start init plugins.  | com.huawei.flume.PluginManager.PluginManager.&lt;init&gt;(PluginManager.java:39)</span><br><span class="line">2021-01-06 11:31:26,510 | INFO  | [conf-file-poller-0] |  Set plugins configuration file dir successful.  | com.huawei.flume.PluginManager.PluginManager.&lt;init&gt;(PluginManager.java:46)</span><br><span class="line">2021-01-06 11:31:26,511 | INFO  | [conf-file-poller-0] |  Reading monitor server configuration from: &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;flume-check.properties  | com.huawei.flume.configuration.AbstractPluginsConfiguration.loadConfig(AbstractPluginsConfiguration.java:75)</span><br><span class="line">2021-01-06 11:31:26,517 | WARN  | [conf-file-poller-0] |  Needn&#39;t to create PluginsManager, plugins is empty.  | com.huawei.flume.PluginManager.PluginManager.&lt;init&gt;(PluginManager.java:55)</span><br><span class="line">2021-01-06 11:31:26,517 | WARN  | [conf-file-poller-0] |  Have not set any plugins  | com.huawei.flume.PluginManager.PluginManager.start(PluginManager.java:98)</span><br><span class="line">2021-01-06 11:31:26,517 | INFO  | [conf-file-poller-0] |  starting compment mon  | org.apache.flume.node.Application.startCompMon(Application.java:543)</span><br><span class="line">2021-01-06 11:31:26,517 | INFO  | [conf-file-poller-0] |  started compment mon success  | org.apache.flume.node.Application.startCompMon(Application.java:582)</span><br><span class="line">2021-01-06 11:31:26,542 | INFO  | [lifecycleSupervisor-1-0] |  jetty-6.1.26  | org.mortbay.log.Slf4jLog.info(Slf4jLog.java:67)</span><br><span class="line">2021-01-06 11:31:26,577 | INFO  | [lifecycleSupervisor-1-0] |  Started SelectChannelConnector@0.0.0.0:41600  | org.mortbay.log.Slf4jLog.info(Slf4jLog.java:67)</span><br><span class="line">2021-01-06 11:31:26,578 | INFO  | [lifecycleSupervisor-1-0] |  Monitored counter group for type: SOURCE, name: src_http_41600: Successfully registered new MBean.  | org.apache.flume.instrumentation.MonitoredCounterGroup.register(MonitoredCounterGroup.java:132)</span><br><span class="line">2021-01-06 11:31:26,578 | INFO  | [lifecycleSupervisor-1-0] |  Component type: SOURCE, name: src_http_41600 started  | org.apache.flume.instrumentation.MonitoredCounterGroup.start(MonitoredCounterGroup.java:105)</span><br><span class="line">2021-01-06 11:31:27,187 | INFO  | [lifecycleSupervisor-1-3] |  Monitored counter group for type: SINK, name: sink_kudu_table: Successfully registered new MBean.  | org.apache.flume.instrumentation.MonitoredCounterGroup.register(MonitoredCounterGroup.java:132)</span><br></pre></td></tr></table></figure>

<p>可以看到，sink启动成功。</p>
<p>记录几个需要用到的命令：</p>
<h3 id="同步kudu-flume-sink到各flume节点"><a href="#同步kudu-flume-sink到各flume节点" class="headerlink" title="同步kudu-flume-sink到各flume节点"></a>同步kudu-flume-sink到各flume节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_nodes&#x3D;&quot;node-str-corelgoh node-str-corenydJ node-str-coreoVpr&quot;;for ip in $(echo $&#123;str_nodes&#125;);do scp &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;lib&#x2F;kudu-flume-sink-1.4.0.jar $&#123;ip&#125;:&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;lib&#x2F;;ssh $&#123;ip&#125; &#39;chmod 751 &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;lib&#x2F;kudu-flume-sink-1.4.0.jar &amp;&amp; chown omm:ficommon &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;install&#x2F;FusionInsight-Flume-1.6.0&#x2F;flume&#x2F;lib&#x2F;kudu-flume-sink-1.4.0.jar&#39;;done</span><br></pre></td></tr></table></figure>

<h3 id="修改对应的jass配置-和-凭据信息同步"><a href="#修改对应的jass配置-和-凭据信息同步" class="headerlink" title="修改对应的jass配置 和 凭据信息同步"></a>修改对应的jass配置 和 凭据信息同步</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_nodes&#x3D;&quot;node-str-corelgoh node-str-corenydJ node-str-coreoVpr&quot;;for ip in $(echo $&#123;str_nodes&#125;);do scp &#x2F;tmp&#x2F;krb5.conf $&#123;ip&#125;:&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;; scp &#x2F;tmp&#x2F;user.keytab $&#123;ip&#125;:&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;;ssh $&#123;ip&#125; &quot;sed -i -e &#39;&#x2F;principal&#x2F;s&#x2F;flume&#x2F;hiveuser&#x2F;g&#39; -e &#39;&#x2F;keyTab&#x2F;s&#x2F;\&#x2F;opt\&#x2F;Bigdata\&#x2F;MRS_2.1.0\&#x2F;install\&#x2F;FusionInsight-Flume-1.6.0\&#x2F;flume\&#x2F;conf\&#x2F;flume.keytab&#x2F;\&#x2F;opt\&#x2F;Bigdata\&#x2F;MRS_2.1.0\&#x2F;1_7_Flume\&#x2F;etc\&#x2F;user.keytab&#x2F;g&#39;  -e &#39;&#x2F;^Client&#x2F;s&#x2F;Client&#x2F;com.sun.security.jgss.initiate&#x2F;g&#39; &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;jaas.conf;chown omm:wheel &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;jaas.conf;chown -R omm:wheel &#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;&quot;;done</span><br></pre></td></tr></table></figure>

<h2 id="这个不是命令，但是是记得最新的GC-OPTS参数"><a href="#这个不是命令，但是是记得最新的GC-OPTS参数" class="headerlink" title="这个不是命令，但是是记得最新的GC_OPTS参数"></a>这个不是命令，但是是记得最新的GC_OPTS参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xms2G -Xmx4G -XX:CMSFullGCsBeforeCompaction&#x3D;1 -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -XX:+UseCMSCompactAtFullCollection -Djava.security.krb5.conf&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;krb5.conf -Djava.security.auth.login.config&#x3D;&#x2F;opt&#x2F;Bigdata&#x2F;MRS_2.1.0&#x2F;1_7_Flume&#x2F;etc&#x2F;jaas.conf -Dzookeeper.request.timeout&#x3D;120000</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/大数据/">大数据</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/大数据/">大数据</a><a href="/tags/flume/">flume</a><a href="/tags/kudu/">kudu</a>
    </span>
    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2025 白菜(whiteCcinn)
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>